/*! tinyColorPicker - v1.0.0 2015-04-18 */
!function(e,r){"use strict";function t(e,t,n,o,a){if("string"==typeof t){var t=y.txt2color(t);n=t.type,g[n]=t[n],a=a!==r?a:t.alpha}else if(t)for(var s in t)e[n][s]=u(t[s]/d[n][s][1],0,1);return a!==r&&(e.alpha=+a),i(n,o?e:r)}function n(e,r,t){var n=h.options.grey,i={};return i.RGB={r:e.r,g:e.g,b:e.b},i.rgb={r:r.r,g:r.g,b:r.b},i.alpha=t,i.equivalentGrey=Math.round(n.r*e.r+n.g*e.g+n.b*e.b),i.rgbaMixBlack=c(r,{r:0,g:0,b:0},t,1),i.rgbaMixWhite=c(r,{r:1,g:1,b:1},t,1),i.rgbaMixBlack.luminance=s(i.rgbaMixBlack,!0),i.rgbaMixWhite.luminance=s(i.rgbaMixWhite,!0),h.options.customBG&&(i.rgbaMixCustom=c(r,h.options.customBG,t,1),i.rgbaMixCustom.luminance=s(i.rgbaMixCustom,!0),h.options.customBG.luminance=s(h.options.customBG,!0)),i}function i(e,r){var t,i,u,p=r||g,f=y,v=h.options,b=d,m=p.RND,w="",x="",_={hsl:"hsv",rgb:e},k=m.rgb;if("alpha"!==e){for(var C in b)if(!b[C][C]){e!==C&&(x=_[C]||"rgb",p[C]=f[x+"2"+C](p[x])),m[C]||(m[C]={}),t=p[C];for(w in t)m[C][w]=Math.round(t[w]*b[C][w][1])}k=m.rgb,p.HEX=f.RGB2HEX(k),p.equivalentGrey=v.grey.r*p.rgb.r+v.grey.g*p.rgb.g+v.grey.b*p.rgb.b,p.webSave=i=o(k,51),p.webSmart=u=o(k,17),p.saveColor=k.r===i.r&&k.g===i.g&&k.b===i.b?"web save":k.r===u.r&&k.g===u.g&&k.b===u.b?"web smart":"",p.hueRGB=y.hue2RGB(p.hsv.h),r&&(p.background=n(k,p.rgb,p.alpha))}var B,M,$,E=p.rgb,G=p.alpha,S="luminance",R=p.background;return B=c(E,{r:0,g:0,b:0},G,1),B[S]=s(B,!0),p.rgbaMixBlack=B,M=c(E,{r:1,g:1,b:1},G,1),M[S]=s(M,!0),p.rgbaMixWhite=M,v.customBG&&($=c(E,R.rgbaMixCustom,G,1),$[S]=s($,!0),$.WCAG2Ratio=l($[S],R.rgbaMixCustom[S]),p.rgbaMixBGMixCustom=$,$.luminanceDelta=Math.abs($[S]-R.rgbaMixCustom[S]),$.hueDelta=a(R.rgbaMixCustom,$,!0)),p.RGBLuminance=s(k),p.HUELuminance=s(p.hueRGB),v.convertCallback&&v.convertCallback(p,e),p}function o(e,r){var t={},n=0,i=r/2;for(var o in e)n=e[o]%r,t[o]=e[o]+(n>i?r-n:-n);return t}function a(e,r,t){return(Math.max(e.r-r.r,r.r-e.r)+Math.max(e.g-r.g,r.g-e.g)+Math.max(e.b-r.b,r.b-e.b))*(t?255:1)/765}function s(e,r){for(var t=r?1:255,n=[e.r/t,e.g/t,e.b/t],i=h.options.luminance,o=n.length;o--;)n[o]=n[o]<=.03928?n[o]/12.92:Math.pow((n[o]+.055)/1.055,2.4);return i.r*n[0]+i.g*n[1]+i.b*n[2]}function c(e,t,n,i){var o={},a=n!==r?n:1,s=i!==r?i:1,c=a+s*(1-a);for(var l in e)o[l]=(e[l]*a+t[l]*s*(1-a))/c;return o.a=c,o}function l(e,r){var t=1;return t=e>=r?(e+.05)/(r+.05):(r+.05)/(e+.05),Math.round(100*t)/100}function u(e,r,t){return e>t?t:r>e?r:e}var d={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},h={},g={},p={r:.298954,g:.586434,b:.114612},f={r:.2126,g:.7152,b:.0722},v=e.Colors=function(e){this.colors={RND:{}},this.options={color:"rgba(204, 82, 37, 0.8)",grey:p,luminance:f,valueRanges:d},b(this,e||{})},b=function(e,n){var i,o=e.options;m(e);for(var a in n)n[a]!==r&&(o[a]=n[a]);i=o.customBG,o.customBG="string"==typeof i?y.txt2color(i).rgb:i,g=t(e.colors,o.color,r,!0)},m=function(e){h!==e&&(h=e,g=e.colors)};v.prototype.setColor=function(e,n,o){return m(this),e?t(this.colors,e,n,r,o):(o!==r&&(this.colors.alpha=o),i(n))},v.prototype.setCustomBackground=function(e){return m(this),this.options.customBG="string"==typeof e?y.txt2color(e).rgb:e,t(this.colors,r,"rgb")},v.prototype.saveAsBackground=function(){return m(this),t(this.colors,r,"rgb",!0)};var y={txt2color:function(e){var r={},t=e.replace(/(?:#|\)|%)/g,"").split("("),n=(t[1]||"").split(/,\s*/),i=t[1]?t[0].substr(0,3):"rgb",o="";if(r.type=i,r[i]={},t[1])for(var a=3;a--;)o=i[a]||i.charAt(a),r[i][o]=+n[a]/d[i][o][1];else r.rgb=y.HEX2rgb(t[0]);return r.alpha=n[3]?+n[3]:1,r},RGB2HEX:function(e){return((e.r<16?"0":"")+e.r.toString(16)+(e.g<16?"0":"")+e.g.toString(16)+(e.b<16?"0":"")+e.b.toString(16)).toUpperCase()},HEX2rgb:function(e){return e=e.split(""),{r:parseInt(e[0]+e[e[3]?1:0],16)/255,g:parseInt(e[e[3]?2:1]+(e[3]||e[1]),16)/255,b:parseInt((e[4]||e[2])+(e[5]||e[2]),16)/255}},hue2RGB:function(e){var r=6*e,t=~~r%6,n=6===r?0:r-t;return{r:Math.round(255*[1,1-n,0,0,n,1][t]),g:Math.round(255*[n,1,1,1-n,0,0][t]),b:Math.round(255*[0,0,n,1,1,1-n][t])}},rgb2hsv:function(e){var r,t,n,i=e.r,o=e.g,a=e.b,s=0;return a>o&&(o=a+(a=o,0),s=-1),t=a,o>i&&(i=o+(o=i,0),s=-2/6-s,t=Math.min(o,a)),r=i-t,n=i?r/i:0,{h:1e-15>n?g&&g.hsl&&g.hsl.h||0:r?Math.abs(s+(o-a)/(6*r)):0,s:i?r/i:g&&g.hsv&&g.hsv.s||0,v:i}},hsv2rgb:function(e){var r=6*e.h,t=e.s,n=e.v,i=~~r,o=r-i,a=n*(1-t),s=n*(1-o*t),c=n*(1-(1-o)*t),l=i%6;return{r:[n,s,a,a,c,n][l],g:[c,n,n,s,a,a][l],b:[a,a,c,n,n,s][l]}},hsv2hsl:function(e){var r=(2-e.s)*e.v,t=e.s*e.v;return t=e.s?1>r?r?t/r:0:t/(2-r):0,{h:e.h,s:e.v||t?t:g&&g.hsl&&g.hsl.s||0,l:r/2}},rgb2hsl:function(e,r){var t=y.rgb2hsv(e);return y.hsv2hsl(r?t:g.hsv=t)},hsl2rgb:function(e){var r=6*e.h,t=e.s,n=e.l,i=.5>n?n*(1+t):n+t-t*n,o=n+n-i,a=i?(i-o)/i:0,s=~~r,c=r-s,l=i*a*c,u=o+l,d=i-l,h=s%6;return{r:[i,d,o,o,u,i][h],g:[u,i,i,d,o,o][h],b:[o,o,u,i,i,d][h]}}}}(window),function(e,r,t){"use strict";function n(r){return r.value||r.getAttribute("value")||e(r).css("background-color")||"#fff"}function i(e){return e=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0]:e,e.originalEvent?e.originalEvent:e}function o(r){return e(r.find(b.doRender)[0]||r[0])}function a(r){var t=e(this),i=t.offset(),a=e(window),c=b.gap;e(".colour.active, .colourBack.active").removeClass("active"),r?(m=o(t),f.$trigger=t,m.hasClass("noAlpha")?e(".cp-alpha").hide():e(".cp-alpha").show(),m.hasClass("disableable")?(e(".cp-blank").show(),F=164):(e(".cp-blank").hide(),F=218),e(".cp-z-slider").height(F),m.addClass("active"),t.parent(".colourBack").addClass("active"),(y||s()).css({left:(y[0]._left=i.left)-((y[0]._left=y[0]._left+y[0]._width-(a.scrollLeft()+a.width()))+c>0?y[0]._left+c:0),top:(y[0]._top=i.top+t.outerHeight())-((y[0]._top=y[0]._top+y[0]._height-(a.scrollTop()+a.height()))+c>0?y[0]._top+c:0)}).show(b.animationSpeed,function(){r!==!0&&(k._width=k.width(),w._width=w.width(),w._height=w.height(),v.setColor(n(m[0])),h(!0))})):e(y).hide(b.animationSpeed,function(){m.blur(),f.$trigger=null,h(!1)})}function s(){return e("head").append('<style type="text/css">'+(b.css||H)+(b.cssAddon||"")+"</style>"),f.$UI=y=e(U).css({margin:b.margin}).appendTo("body").show(0,function(){var r=e(this);S=b.GPU&&r.css("perspective")!==t,w=e(".cp-xy-slider",this),x=e(".cp-xy-cursor",this),_=e(".cp-z-cursor",this),k=e(".cp-alpha",this).toggle(!!b.opacity),C=e(".cp-alpha-cursor",this),b.buildCallback.call(f,r),r.prepend("<div>").children().eq(0).css("width",r.children().eq(0).width()),this._width=this.offsetWidth,this._height=this.offsetHeight}).hide().on(E,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)}function c(r){var t=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");r.preventDefault&&r.preventDefault(),r.returnValue=!1,m._offset=e(this).offset(),(t="xy_slider"===t?l:"z_slider"===t?u:d)(r),h(),B.on(G,function(){B.off(".a")}).on($,function(e){t(e),h()})}function l(e){var r=i(e),t=r.pageX-m._offset.left,n=r.pageY-m._offset.top;v.setColor({s:t/w._width*100,v:100-n/w._height*100},"hsv")}function u(e){var r=i(e).pageY-m._offset.top;v.setColor({h:360-r/F*360},"hsv")}function d(e){var r=i(e).pageX-m._offset.left,t=r/k._width;v.setColor({},"rgb",t)}function h(e){var r=v.colors,n=r.hueRGB,i=r.RND.rgb,o=r.RND.hsl,a="#222",s="#ddd",c=m.data("colorMode"),l=1!==r.alpha,u=Math.round(100*r.alpha)/100,d=i.r+", "+i.g+", "+i.b,h="HEX"!==c||l?"rgb"===c||"HEX"===c&&l?l?"rgba("+d+", "+u+")":"rgb("+d+")":"hsl"+(l?"a(":"(")+o.h+", "+o.s+"%, "+o.l+"%"+(l?", "+u:"")+")":"#"+r.HEX,p=r.HUELuminance>.22?a:s,f=r.rgbaMixBlack.luminance>.22?a:s,b=(1-r.hsv.h)*F,y=r.hsv.s*w._width,B=(1-r.hsv.v)*F,M=u*k._width,$=S?"translate3d":"",E=m.val(),G=m[0].hasAttribute("value")&&""===E&&e!==t;w._css={backgroundColor:"rgb("+n.r+","+n.g+","+n.b+")"},x._css={transform:$+"("+y+"px, "+B+"px, 0)",left:S?"":y,top:S?"":B,borderColor:r.RGBLuminance>.22?a:s},_._css={transform:$+"(0, "+b+"px, 0)",top:S?"":b,borderColor:"transparent "+p},k._css={backgroundColor:"rgb("+d+")"},C._css={transform:$+"("+M+"px, 0, 0)",left:S?"":M,borderColor:f+" transparent"},m._css={backgroundColor:G?"":h,color:G?"":r.rgbaMixBGMixCustom.luminance>.22?a:s},m.text=G?"":E!==h?h:"",e!==t?g(e):R(g)}function g(e){w.css(w._css),x.css(x._css),_.css(_._css),k.css(k._css),C.css(C._css),b.doRender&&m.css(m._css),m.text&&m.val(m.text),b.renderCallback.call(f,m,"boolean"==typeof e?e:t)}var p,f,v,b,m,y,w,x,_,k,C,B=e(document),M="",$="touchmove.a mousemove.a pointermove.a",E="touchstart.a mousedown.a pointerdown.a",G="touchend.a mouseup.a pointerup.a",S=!1,R=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){e()},U='<div class="colourPicker"><div class="cp-blank"></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',H="",F=164,A=function(e){v=this.color=new r(e),b=v.options};A.prototype={render:h,toggle:a},e.fn.colorPicker=function(r){var t=function(){};return r=e.extend({animationSpeed:100,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:t,buildCallback:t,body:document.body,scrollResize:!0,gap:4},r),!f&&r.scrollResize&&e(window).on("resize.a scroll.a",function(){f.$trigger&&f.toggle.call(f.$trigger[0],!0)}),p=p?p.add(this):this,p.colorPicker=f||(f=new A(r)),M+=(M?", ":"")+this.selector,e(r.body).off(".a").on(E,function(r){var t=e(r.target);-1!==e.inArray(t.closest(M)[0],p)||t.closest(y).length||a()}).on("focus.a click.a",M,a).on("change.a",M,function(){v.setColor(this.value||"#FFF"),p.colorPicker.render(!0)}),this.each(function(){var t=n(this),i=t.split("("),a=o(e(this));a.data("colorMode",i[1]?i[0].substr(0,3):"HEX").attr("readonly",b.preventFocus),r.doRender&&a.css({"background-color":t,color:function(){return v.setColor(t).rgbaMixBGMixCustom.luminance>.22?"#222":"#ddd"}})})},e.fn.colorPicker.destroy=function(){e(f.color.options.body).off(".a"),f.toggle(!1),p=null,M=""}}(jQuery,Colors),function(){$(document).on("ready page:load",function(){var e,r;return $("#layers").on("click",".sliderV, .colour",function(){return $("#changes_"+$(this).parentsUntil("#layers",".layer").find(".orderingField").val()).val("1")}),$("#sliderBaseOpacity, #labelsBaseOpacity").click(function(){return $("#changes_0").val("1")}),r=document.getElementById("sliderBaseOpacity"),r&&(e=document.getElementById("baseOpacity"),noUiSlider.create(r,{start:e.value,step:12.5,connect:"lower",range:{min:0,max:99}}),r.noUiSlider.on("update",function(r,t){return e.value=r[t]}),document.getElementById("waterVal").addEventListener("click",function(){return r.noUiSlider.set(0)}),document.getElementById("juiceVal").addEventListener("click",function(){return r.noUiSlider.set(25)}),document.getElementById("syrupVal").addEventListener("click",function(){return r.noUiSlider.set(50)}),document.getElementById("jellyVal").addEventListener("click",function(){return r.noUiSlider.set(75)}),document.getElementById("creamVal").addEventListener("click",function(){return r.noUiSlider.set(100)}),$(".sliderV").each(function(){return $(this).initVSlider()})),$(".colour").colorPicker(),$(".add_layer").click(function(e){var r,t,n,i,o;return e.preventDefault(),r=$("#layers"),o=(new Date).getTime(),i=new RegExp($(this).data("id"),"g"),n=r.find(".layer").size(),n>=2&&r.prepend("<svg class='iSwap' data-ordering='"+n+"'><use xlink:href='#swap'/></svg>"),r.prepend($(this).data("fields").replace(i,o)),t=r.find(".layer").first(),t.find(".orderingField").val(n),t.find("label.uncheckable").uncheckableRadioLabel(),t.find(".colour").colorPicker(),$("#changes").prepend('<input type="hidden" name="changes['+n+']" id="changes_'+n+'">'),$("#changes_"+n).val("1"),t.find(".sliderV").each(function(){return $(this).initVSlider()}),t.slideDown(500),t.find(".removeLayer").click(function(){var e;return $(this).next("input").val("1"),$("#changes_"+t.find(".orderingField").val()).remove(),e=void 0,e=0===t.next(".iSwap").size()?t.prev(".iSwap"):t.next(".iSwap"),e.slideUp(100,function(){return e.remove()}),t.slideUp(500,function(){return $("#layers").after(t)})})}),$("#layers").on("click",".iSwap",function(){var e,r,t,n,i;return t=$(this).data("ordering"),i=$(this).prevAll(".layer").first(),r=$(this).nextAll(".layer").first(),r.find(".orderingField").val(t),i.find(".orderingField").val(t-1),$(this).before(r),$(this).after(i),r.removeClass("upped downed"),setTimeout(function(){return r.addClass("upped")},5),i.removeClass("downed upped"),setTimeout(function(){return i.addClass("downed")},5),n=$("#layer_"+t),e=$("#layer_"+(t-1)),n.attr("id","layer_"+(t-1)),e.attr("id","layer_"+t),e.before(n)})}),function(e){return e.fn.initVSlider=function(){var r,t;t=this[0],r=e(t).next()[0],noUiSlider.create(t,{start:r.value,connect:"lower",step:1,orientation:"vertical",direction:"rtl",range:{min:0,max:99}}),t.noUiSlider.on("update",function(e){return r.value=e[0]}),e.inArray("pMagnet_intensity",t.classList)>=0&&t.noUiSlider.on("slide",function(r){var n;n=e(t).parent().parent().parent().find(".magnets"),r[0]>0?n.show(300):n.hide(300)})}}(jQuery)}.call(this);